<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold Sniper | سیگنال حرفه‌ای طلا</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-deep: #050505;
            --card-bg: rgba(20, 20, 20, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --buy-color: #00E396;
            --sell-color: #FF4560;
            --gold-accent: #FFD700;
            --text-main: #E0E0E0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Vazirmatn', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 10%, #1a1a00 0%, var(--bg-deep) 60%);
            color: var(--text-main);
            padding-bottom: 20px;
            overflow-x: hidden;
        }

        /* استایل شیشه‌ای پیشرفته */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }

        /* هدر */
        .header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--glass-border);
        }
        .logo { font-size: 1.1rem; font-weight: 900; color: var(--gold-accent); letter-spacing: 1px; }
        .live-indicator { display: flex; align-items: center; gap: 5px; font-size: 0.7rem; color: var(--buy-color); }
        .blink { width: 8px; height: 8px; background: var(--buy-color); border-radius: 50%; animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* قیمت بزرگ */
        .hero-price {
            text-align: center;
            padding: 20px 0;
        }
        .current-price {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -1px;
            transition: color 0.3s;
        }
        .symbol-name { font-size: 0.9rem; color: #888; margin-bottom: 5px; }

        /* کارت سیگنال (مهم) */
        .signal-card {
            margin: 0 15px 20px;
            padding: 0;
            overflow: hidden;
            position: relative;
        }
        
        .signal-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.03);
        }
        
        .signal-type {
            font-size: 1.2rem;
            font-weight: 900;
            padding: 5px 15px;
            border-radius: 8px;
            text-transform: uppercase;
        }
        .type-long { background: rgba(0, 227, 150, 0.15); color: var(--buy-color); border: 1px solid var(--buy-color); }
        .type-short { background: rgba(255, 69, 96, 0.15); color: var(--sell-color); border: 1px solid var(--sell-color); }

        .timeframe-badge {
            font-size: 0.8rem;
            background: rgba(255,255,255,0.1);
            padding: 4px 10px;
            border-radius: 6px;
        }

        .signal-body { padding: 15px; }
        
        .grid-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .data-point span:first-child { font-size: 0.75rem; color: #888; display: block; margin-bottom: 3px; }
        .data-point span:last-child { font-size: 1.1rem; font-weight: bold; font-family: 'Courier New', monospace; }

        .targets-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
        }
        .target-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dashed rgba(255,255,255,0.1);
        }
        .target-row:last-child { border: none; margin: 0; padding: 0; }
        .tp-label { color: var(--buy-color); }
        
        /* دکمه‌های کنترل تایم فریم */
        .tf-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tf-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            color: #888;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .tf-btn.active {
            background: var(--gold-accent);
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* کانتینر چارت */
        .chart-container {
            height: 500px;
            margin: 0 10px;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

    </style>
</head>
<body>

    <div class="header glass">
        <div class="logo"><i class="fa-solid fa-crosshairs"></i> GOLD SNIPER</div>
        <div class="live-indicator"><div class="blink"></div> WebSocket Connected</div>
    </div>

    <!-- قیمت لحظه ای بزرگ -->
    <div class="hero-price">
        <div class="symbol-name">XAU/USD - انس جهانی طلا</div>
        <div class="current-price" id="live-price">---.--</div>
    </div>

    <!-- انتخاب تایم فریم سیگنال -->
    <div class="tf-selector">
        <button class="tf-btn" onclick="updateSignal('15m', this)">M15 (اسکلپ)</button>
        <button class="tf-btn active" onclick="updateSignal('1h', this)">H1 (روزانه)</button>
        <button class="tf-btn" onclick="updateSignal('4h', this)">H4 (سووینگ)</button>
    </div>

    <!-- کارت سیگنال هوشمند -->
    <div class="glass signal-card">
        <div class="signal-header">
            <div class="signal-type type-long" id="sig-type">LONG BUY</div>
            <div class="timeframe-badge" id="sig-tf">Timeframe: 1H</div>
        </div>
        <div class="signal-body">
            <div class="grid-row">
                <div class="data-point">
                    <span>نقطه ورود (Entry)</span>
                    <span id="sig-entry" style="color: #fff">2030.50</span>
                </div>
                <div class="data-point">
                    <span>حد ضرر (Stop Loss)</span>
                    <span id="sig-sl" style="color: var(--sell-color)">2025.00</span>
                </div>
            </div>
            
            <div class="targets-box">
                <div class="target-row">
                    <span class="tp-label">Target 1 (TP1)</span>
                    <span id="sig-tp1">2033.00</span>
                </div>
                <div class="target-row">
                    <span class="tp-label">Target 2 (TP2)</span>
                    <span id="sig-tp2">2036.50</span>
                </div>
                <div class="target-row">
                    <span class="tp-label">Target 3 (TP3)</span>
                    <span id="sig-tp3">2045.00</span>
                </div>
            </div>
            
            <div style="margin-top: 15px; font-size: 0.75rem; color: #666; text-align: center;">
                <i class="fa-solid fa-robot"></i> تحلیل شده توسط الگوریتم تکنیکال RSI + MACD
            </div>
        </div>
    </div>

    <!-- چارت تریدینگ ویو -->
    <h3 style="padding-right: 20px; font-size: 0.9rem; color: #888; margin-bottom: 10px;">نمودار تکنیکال پیشرفته</h3>
    <div class="glass chart-container">
        <!-- TradingView Widget BEGIN -->
        <div class="tradingview-widget-container" style="height:100%;width:100%">
            <div id="tradingview_chart" style="height:100%;width:100%"></div>
        </div>
        <!-- TradingView Widget END -->
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        // متغیرهای گلوبال
        let currentPrice = 0;
        let lastPrice = 0;
        let activeTimeframe = '1h';

        // 1. اتصال به وب‌سوکت بایننس (برای دریافت قیمت واقعی طلا - PAXG معادل طلا)
        // توجه: برای تست واقعی بودن قیمت، این بخش به نت آزاد نیاز دارد. اگر قطع شد، قیمت ثابت می‌ماند.
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/paxgusdt@trade');
        const priceEl = document.getElementById('live-price');

        ws.onmessage = (event) => {
            const stockObject = JSON.parse(event.data);
            currentPrice = parseFloat(stockObject.p);
            
            // نمایش قیمت
            priceEl.innerText = currentPrice.toFixed(2);
            
            // تغییر رنگ بر اساس نوسان
            if (currentPrice > lastPrice) {
                priceEl.style.color = 'var(--buy-color)';
            } else if (currentPrice < lastPrice) {
                priceEl.style.color = 'var(--sell-color)';
            }
            
            lastPrice = currentPrice;

            // آپدیت زنده محاسبات سیگنال (اگر قیمت خیلی تغییر کرد)
            // در حالت واقعی، سیگنال نباید هر ثانیه عوض شود، اما تارگت ها را بروز میکنیم
        };

        // 2. راه‌اندازی نمودار مولتی تایم‌فریم
        new TradingView.widget({
            "autosize": true,
            "symbol": "OANDA:XAUUSD",
            "interval": "60", // پیش فرض 1 ساعت
            "timezone": "Asia/Tehran",
            "theme": "dark",
            "style": "1", // کندل استیک
            "locale": "fa",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "hide_top_toolbar": false, // نمایش تولبار برای تغییر تایم فریم
            "hide_legend": false,
            "save_image": false,
            "container_id": "tradingview_chart",
            "backgroundColor": "rgba(5, 5, 5, 1)",
            "gridColor": "rgba(255, 255, 255, 0.05)",
            "allow_symbol_change": true // اجازه تغییر نماد توسط کاربر
        });

        // 3. منطق محاسبه سیگنال (شبیه‌ساز هوشمند)
        // این تابع بر اساس قیمت فعلی و تایم فریم انتخابی، یک پوزیشن منطقی تولید می‌کند
        function generateSignalData(tf) {
            // دریافت قیمت پایه (اگر هنوز لود نشده، پیشفرض میگذاریم)
            let basePrice = currentPrice > 0 ? currentPrice : 2035.00;
            
            // پارامترهای نوسان بر اساس تایم فریم
            let range = 0;
            let direction = Math.random() > 0.5 ? 'LONG' : 'SHORT'; // جهت تصادفی برای دمو (در نسخه سرور واقعی محاسبه میشود)
            
            if(tf === '15m') range = 3.5;  // اسکلپ: اهداف کوچک
            if(tf === '1h') range = 8.0;   // روزانه: اهداف متوسط
            if(tf === '4h') range = 25.0;  // سووینگ: اهداف بزرگ

            // المان های DOM
            const typeEl = document.getElementById('sig-type');
            const tfEl = document.getElementById('sig-tf');
            const entryEl = document.getElementById('sig-entry');
            const slEl = document.getElementById('sig-sl');
            const tp1El = document.getElementById('sig-tp1');
            const tp2El = document.getElementById('sig-tp2');
            const tp3El = document.getElementById('sig-tp3');

            tfEl.innerText = `Timeframe: ${tf.toUpperCase()}`;

            if(direction === 'LONG') {
                // تنظیم ظاهری
                typeEl.innerText = 'LONG BUY';
                typeEl.className = 'signal-type type-long';

                // محاسبات ریاضی پوزیشن لانگ
                let entry = basePrice;
                let sl = basePrice - (range * 0.6); 
                let tp1 = basePrice + (range * 0.5);
                let tp2 = basePrice + (range * 1.0);
                let tp3 = basePrice + (range * 2.0);

                entryEl.innerText = entry.toFixed(2);
                slEl.innerText = sl.toFixed(2);
                tp1El.innerText = tp1.toFixed(2);
                tp2El.innerText = tp2.toFixed(2);
                tp3El.innerText = tp3.toFixed(2);

            } else {
                // تنظیم ظاهری
                typeEl.innerText = 'SHORT SELL';
                typeEl.className = 'signal-type type-short';

                // محاسبات ریاضی پوزیشن شورت
                let entry = basePrice;
                let sl = basePrice + (range * 0.6); 
                let tp1 = basePrice - (range * 0.5);
                let tp2 = basePrice - (range * 1.0);
                let tp3 = basePrice - (range * 2.0);

                entryEl.innerText = entry.toFixed(2);
                slEl.innerText = sl.toFixed(2);
                tp1El.innerText = tp1.toFixed(2);
                tp2El.innerText = tp2.toFixed(2);
                tp3El.innerText = tp3.toFixed(2);
            }
        }

        function updateSignal(tf, btnElement) {
            // تغییر کلاس دکمه ها
            if(btnElement) {
                document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
            }
            
            activeTimeframe = tf;
            
            // حالت لودینگ کوتاه برای حس واقعی بودن محاسبه
            document.querySelector('.signal-body').style.opacity = '0.5';
            setTimeout(() => {
                generateSignalData(tf);
                document.querySelector('.signal-body').style.opacity = '1';
            }, 300);
        }

        // اجرای اولیه با یک تاخیر کوتاه تا قیمت لود شود
        setTimeout(() => {
            updateSignal('1h', null);
        }, 1000);

    </script>
</body>
</html>
